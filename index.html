<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="src/m65c02.js"></script>
    <!--<script src="refs/logs.txt"></script>-->
    <script src="src/wqx.js"></script>
    <style>
        #wqx {
            width: 640px;
            height: 320px;
            background-color: #32cd32;
        }
    </style>
</head>
<body>
<button id="load_demo" onclick="loadDemo();">loadDemo</button>
<button id="run" onclick="run();" disabled>run</button>
<button id="stop" onclick="stop();" disabled>stop</button>
<div id="wqx"></div>
<script>
    var div = document.getElementById('wqx');
    var wqx = new Wqx(div);
//    div.addEventListener('dragover', function (evt){
//        evt.preventDefault();
//    });
//    div.addEventListener('drop', function (evt){
//        var file;
//        try {
//            file = evt.dataTransfer.files[0];
//        } catch(ex){}
//        var fileReader = new FileReader();
//        fileReader.addEventListener('loadend', function (evt){
//            wqx.loadBROM(fileReader.result);
//            wqx.run();
//        });
//        fileReader.readAsArrayBuffer(file);
//        evt.preventDefault();
//    });

    var romLoaded = false;
    var norLoaded = false;
    function run(){
        wqx.run();
        document.getElementById('run').setAttribute('disabled', 'disabled');
        document.getElementById('stop').removeAttribute('disabled');
    }
    function stop(){
        wqx.stop();
        document.getElementById('stop').setAttribute('disabled', 'disabled');
        document.getElementById('run').removeAttribute('disabled');
    }
    function loadDemo(){
        // chrome allow local ajax: "--allow-file-access-from-files"
        // todo: progress info
        document.getElementById('load_demo').setAttribute('disabled', 'disabled');
        function check(){
            if (romLoaded && norLoaded) {
                document.getElementById('run').removeAttribute('disabled');
            }
        }
        var xhr1 = new XMLHttpRequest();
        xhr1.responseType = 'arraybuffer';
        xhr1.open('GET', './rom/obj.bin', true);
        xhr1.addEventListener('loadend', function (){
            wqx.loadBROM(xhr1.response);
            romLoaded = true;
            check();
        });
        xhr1.send();

        var xhr2 = new XMLHttpRequest();
        xhr2.responseType = 'arraybuffer';
        xhr2.open('GET', './rom/cc800.fls', true);
        xhr2.addEventListener('loadend', function (){
            wqx.loadNorFlash(xhr2.response);
            norLoaded = true;
            check();
        });
        xhr2.send();
    }
</script>
</body>
</html>